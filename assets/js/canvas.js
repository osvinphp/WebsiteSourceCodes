"use strict";var diagramPalette={},availableBlocks={},onScreenBlocks={},blockIcons={},myDiagram=null,usersColor={},newMoleculeTitle=$("#new-molecule-title"),elementProperties=$("#element-properties"),moleculeProperties=$("#molecule-properties"),savedMoleculeProperties=$("#saved-molecule-properties"),propertyBoxTitle=$("#property-box-title"),drillDownTable=$("#drill-down-table"),elementIdentityDataSource=$("#element-identity-data-source"),elementValuesUser=$("#element-values-user"),elementValuesAnyone=$("#element-values-anyone"),elementValuesGroup=$("#element-values-group"),elementValuesDataType=$("#element-values-data-type"),elementValuesDataSource=$("#element-values-data-source"),elementValuesFieldToQuery=$("#element-values-field-to-query"),elementIdentityForm=$("#element-identity-form"),elementValuesForm=$("#element-values-form"),moleculeIdentityDataSource=$("#molecule-identity-data-source"),moleculeValuesUser=$("#molecule-values-user"),moleculeValuesGroup=$("#molecule-values-group"),moleculeValuesUsersCount=$("#molecule-values-users-count"),moleculeIdentityForm=$("#molecule-identity-form"),moleculeValuesForm=$("#molecule-values-form"),moleculeStatusForm=$("#molecule-status-form"),savedMoleculeIdentityForm=$("#saved-molecule-identity-form"),savedMoleculeValuesForm=$("#saved-molecule-values-form"),savedMoleculeStatusForm=$("#saved-molecule-status-form"),barChart=null,_scatterChart=null,$$=go.GraphObject.make,selectedElementData=null,selectedMoleculeData={identity:{},population:{}},Canvas={init:function(){Canvas.main(),Canvas.frequencyChart(),Canvas.scatterChart()},main:function(){$(".building-blocks").each(function(e,a){var t=$(this),n=t.data("id"),o=t.data("svg-icon");blockIcons[n]=o}),$(document).on("click",".on-screen-block",function(){var e=$(this).data("key"),a=myDiagram.findNodeForKey(e);myDiagram.select(a),myDiagram.centerRect(a.actualBounds),Canvas.showNodeProperty(null,a)}),$(document).on("submit","#form-palette",function(e){Canvas.renderPaletteItem(),e.preventDefault()}),$(document).on("keyup","#form-palette input",function(e){Canvas.renderPaletteItem(),e.preventDefault()}),$(document).on("submit","#form-on-screen",function(e){Canvas.renderActiveScreen(),e.preventDefault()}),$(document).on("keyup","#form-on-screen input",function(e){Canvas.renderActiveScreen(),e.preventDefault()}),$(document).on("submit","#element-identity-form",function(e){var a=$(this),t=a.serializeArray(),n=a.find('[name="key"]').val(),o=myDiagram.model.findNodeDataForKey(n);$.each(t,function(e,t){var n=t.name,l=t.value;switch(t.name){case"tags":l=a.find('[name="tags"]').val()}myDiagram.model.setDataProperty(o,n,l)}),Canvas.save(),Canvas.renderActiveScreen(),e.preventDefault()}),$(document).on("submit","#element-values-form",function(e){var a=$(this),t=a.serializeArray(),n=a.find('[name="key"]').val(),o=myDiagram.model.findNodeDataForKey(n),l=a.find(".submit"),r=App.baseUrl("canvas/getElementQuery"),i={fields:{},results:{}};$.each(t,function(e,a){var t=a.name,n=a.value;switch(t){case"user":case"group":case"dataType":case"key":i[t]=n;break;default:i.fields[t]=n}}),App.blockElement(a),l.attr("disabled",!0),App.ajax(r,"post","json",App.serializeForm(a)).error(function(e){App.unblockElement(a),l.attr("disabled",!1)}).done(function(e){App.unblockElement(a),l.attr("disabled",!1),i.results=e,myDiagram.model.setDataProperty(o,"values",i),Canvas.save(),Canvas.renderActiveScreen()}),e.preventDefault()}),$(document).on("submit","#molecule-identity-form",function(e){var a=$(this),t=a.serializeArray(),n=new FormData($(this)[0]),o=a.find(".submit"),l=App.baseUrl("canvas/saveMolecule");$.each(t,function(e,t){var n=t.name,o=t.value;switch(t.name){case"tags":o=a.find('[name="tags"]').val();break;case"name":newMoleculeTitle.text(o)}selectedMoleculeData.identity[n]=o}),Canvas.save();var r=$("#mySavedModel").val();n.append("model",r),App.blockElement(a),o.attr("disabled",!0),App.ajaxFile(l,"post","json",n).error(function(e){App.unblockElement(a),o.attr("disabled",!1)}).done(function(e){App.unblockElement(a),o.attr("disabled",!1),e.status?(swal(e.action,e.message,"success"),$("#all-tab").load(location.href+" #all-tab>*",function(){Canvas.buildPalette()})):swal(e.action,e.message,"error")}),e.preventDefault()}),$(document).on("submit","#molecule-population-form",function(e){var a=$(this),t=a.serializeArray();$.each(t,function(e,t){var n=t.name,o=t.value;switch(t.name){case"tags":o=a.find('[name="tags"]').val();break;default:selectedMoleculeData.population[n]=o}}),Canvas.save(),e.preventDefault()}),App.loadChosen(".chosen"),App.loadTagsInput(".tagsinput"),Canvas.buildWorkspace(),Canvas.buildPalette(),elementIdentityDataSource.chosen({width:"inherit",search_contains:!0}),moleculeIdentityDataSource.chosen({width:"inherit",search_contains:!0}),elementIdentityDataSource.on("change",function(){var e=$(this).val();switch(e){case"Individual":elementValuesUser.closest(".form-group").removeClass("hidden"),elementValuesAnyone.closest(".form-group").addClass("hidden"),elementValuesGroup.closest(".form-group").addClass("hidden");break;case"Anyone":elementValuesAnyone.closest(".form-group").removeClass("hidden"),elementValuesUser.closest(".form-group").addClass("hidden"),elementValuesGroup.closest(".form-group").addClass("hidden");break;case"Group":elementValuesGroup.closest(".form-group").removeClass("hidden"),elementValuesUser.closest(".form-group").addClass("hidden"),elementValuesAnyone.closest(".form-group").addClass("hidden")}elementValuesDataSource.val(e)}),elementValuesDataType.on("change",function(){$(this).closest(".form-group");var e=$(this).val(),a=selectedElementData.values.fields;if(""===e)elementValuesFieldToQuery.empty().change().trigger("chosen:updated").closest(".form-group").addClass("hidden");else{var t=[],n="";switch(e){case"DataAccelerometer":case"DataGyro":case"DataMagnetic":t=[{name:"xReading",label:"xReading",type:"range-unsigned"},{name:"yReading",label:"yReading",type:"range-unsigned"},{name:"zReading",label:"zReading",type:"range-unsigned"}];break;case"DataGravity":t=[{name:"xReading",label:"xReading",type:"range-unsigned"},{name:"yReading",label:"yReading",type:"range-unsigned"},{name:"zReading",label:"zReading",type:"range-unsigned"},{name:"rollReading",label:"Roll Reading",type:"range-unsigned"},{name:"pitchReading",label:"Pitch Reading",type:"range-unsigned"},{name:"azimuthReading",label:"Azimuth Reading",type:"range-unsigned"}];break;case"DataSteps":t=[{name:"stepsReading",label:"Steps Reading",type:"range-unsigned"},{name:"distanceReading",label:"Distance Reading",type:"range-unsigned"},{name:"ascendedReading",label:"Ascended Reading",type:"range-unsigned"},{name:"descendedReading",label:"Descended Reading",type:"range-unsigned"},{name:"paceReading",label:"Pace Reading",type:"range-unsigned"},{name:"cadenceReading",label:"Cadence Reading",type:"range-unsigned"}];break;case"DataAltitude":t=[{name:"pressureReading",label:"Pressure Reading",type:"range-unsigned"},{name:"relativeReading",label:"Relative Reading",type:"range-unsigned"}];break;case"DataLocation":t=[{name:"latLonReading",label:"Lat Lon Reading",type:"text"}];break;case"DataBattery":t=[{name:"levelReading",label:"Level Reading",type:"range-unsigned"},{name:"chargingReading",label:"Charging Reading",type:"boolean"},{name:"fullReading",label:"Full Reading",type:"boolean"}];break;case"DataUV":t=[{name:"exposureReading",label:"Exposure Reading",type:"range-unsigned"},{name:"temperatureReading",label:"Temperature Reading",type:"range-unsigned"}];break;case"DataBloodPressure":t=[{name:"systolicReading",label:"Systolic Reading",type:"range-unsigned"},{name:"diastolicReading",label:"Diastolic Reading",type:"range-unsigned"}];break;case"DataHeartRate":t=[{name:"opticalReading",label:"Optical Reading",type:"range-unsigned"},{name:"averageReading",label:"Average Reading",type:"range-unsigned"}];break;case"DataHRV":t=[{name:"peakFrequency",label:"Peak Frequency",type:"range-unsigned"}];break;case"DataGalvanicSkinResponse":t=[{name:"responseReading",label:"Response Reading",type:"range-unsigned"}];break;case"DataBRProfit":case"DataBRBuy":case"DataBRSale":t=[{name:"tradeValue",label:"Trade Value",type:"range-signed"}]}t.map(function(e){n+='<option data-type="'+e.type+'" value="'+e.name+'">'+e.label+"</option>"}),elementValuesFieldToQuery.empty().append(n).change().trigger("chosen:updated").closest(".form-group").removeClass("hidden")}a.hasOwnProperty("fieldToQuery")&&elementValuesFieldToQuery.val(a.fieldToQuery).change().trigger("chosen:updated")}),elementValuesFieldToQuery.on("change",function(){var e=$(this).closest(".form-group"),a=$(this).find("option:selected"),t=a.data("type"),n=a.text(),o=a.attr("value"),l="",r=selectedElementData.values.fields;if($(".element-value-params").remove(),void 0!==t){switch(t){case"boolean":l+='\n                                <div class="form-group element-value-params">\n                                    <div class="fg-line">\n                                        <label>'+n+'</label>\n                                        <select class="form-control chosen" name='+o+'>\n                                            <option value="true">True</option>\n                                            <option value="false">False</option>\n                                        </select>\n                                    </div>\n                                </div>\n                            ';break;case"range-signed":case"range-unsigned":l+='\n                                <div class="form-group element-value-params">\n                                    <div class="fg-line">\n                                        <label>'+n+'</label>\n                                        <input \n                                            class="'+t+'" \n                                            name="'+o+'" \n                                            value="'+(r.hasOwnProperty("fieldToQuery")?r[o]:"")+'" />\n                                    </div>\n                                </div>\n                            '}$(l).insertAfter(e),App.loadChosen(".chosen"),App.loadRangeSlider(".range-unsigned",{type:"double",min:0,max:1e3,prettify_enabled:!0,prettify_separator:"."}),App.loadRangeSlider(".range-signed",{type:"double",min:-1e3,max:1e3,prettify_enabled:!0,prettify_separator:"."})}}),moleculeIdentityDataSource.on("change",function(){switch($(this).val()){case"Individual":moleculeValuesUser.val("").change().trigger("chosen:updated").closest(".form-group").removeClass("hidden"),moleculeValuesGroup.closest(".form-group").addClass("hidden"),moleculeValuesUsersCount.closest(".form-group").addClass("hidden");break;case"Group":moleculeValuesGroup.val("").change().trigger("chosen:updated").closest(".form-group").removeClass("hidden"),moleculeValuesUser.closest(".form-group").addClass("hidden"),moleculeValuesUsersCount.closest(".form-group").addClass("hidden");break;default:moleculeValuesUsersCount.change().closest(".form-group").removeClass("hidden"),moleculeValuesUser.closest(".form-group").addClass("hidden"),moleculeValuesGroup.closest(".form-group").addClass("hidden")}}),moleculeValuesUser.on("change",function(){var e=$(this).find("option:selected").data(),a=$(this).closest(".form-group"),t="";$(".element-value-params").remove();for(var n in e)e.hasOwnProperty(n)&&(t+=Canvas.renderElementParams([{name:n,value:e[n],type:"text",id:"",class:"form-control"}]));$(t).insertAfter(a),App.loadChosen(".chosen")}),moleculeValuesGroup.on("change",function(){var e=$(this).find("option:selected").data(),a=$(this).closest(".form-group"),t="";$(".element-value-params").remove();for(var n in e)e.hasOwnProperty(n)&&(t+=Canvas.renderElementParams([{name:n,value:e[n],type:"text",id:"",class:"form-control"}]));$(t).insertAfter(a),App.loadChosen(".chosen")}),moleculeValuesUsersCount.on("change",function(){var e=$(this).data(),a=$(this).closest(".form-group"),t="";$(".element-value-params").remove();for(var n in e)e.hasOwnProperty(n)&&(t+=Canvas.renderElementParams([{name:n,value:e[n],type:"text",id:"",class:"form-control"}]));$(t).insertAfter(a),App.loadChosen(".chosen")})},buildWorkspace:function(){function e(e,a,t,n){return $$(go.Shape,"Circle",{fill:null,stroke:null,desiredSize:new go.Size(12,12),alignment:a,alignmentFocus:"B"===e?go.Spot.Top:a,portId:e,fromSpot:a,toSpot:a,fromLinkable:t,toLinkable:n,cursor:"pointer"})}function a(e,a){e.ports.each(function(e){""!==e.portId&&(e.fill=a?"rgba(0,0,0,.3)":null)})}function t(){go.RotatingTool.call(this)}var n=$$(go.Adornment,"Auto",$$(go.Shape,{fill:null,stroke:"deepskyblue",strokeWidth:1.5,strokeDashArray:[4,2]}),$$(go.Placeholder)),o=$$(go.Adornment,"Spot",{locationSpot:go.Spot.Right},$$(go.Placeholder),$$(go.Shape,{alignment:go.Spot.TopLeft,cursor:"nw-resize",desiredSize:new go.Size(6,6),fill:"lightblue",stroke:"deepskyblue"}),$$(go.Shape,{alignment:go.Spot.TopRight,cursor:"ne-resize",desiredSize:new go.Size(6,6),fill:"lightblue",stroke:"deepskyblue"}),$$(go.Shape,{alignment:go.Spot.BottomLeft,cursor:"se-resize",desiredSize:new go.Size(6,6),fill:"lightblue",stroke:"deepskyblue"}),$$(go.Shape,{alignment:go.Spot.BottomRight,cursor:"sw-resize",desiredSize:new go.Size(6,6),fill:"lightblue",stroke:"deepskyblue"})),l=$$(go.Adornment,{locationSpot:go.Spot.Center,locationObjectName:"CIRCLE"},$$(go.Shape,"Circle",{name:"CIRCLE",cursor:"pointer",desiredSize:new go.Size(7,7),fill:"lightblue",stroke:"deepskyblue"}),$$(go.Shape,{geometryString:"M3.5 7 L3.5 30",isGeometryPositioned:!0,stroke:"deepskyblue",strokeWidth:1.5,strokeDashArray:[4,2]})),r=$$(go.Adornment,"Link",$$(go.Shape,{isPanelMain:!0,fill:null,stroke:"deepskyblue",strokeWidth:0}));go.Diagram.inherit(t,go.RotatingTool),t.prototype.updateAdornments=function(e){go.RotatingTool.prototype.updateAdornments.call(this,e);var a=e.findAdornment("Rotating");null!==a&&(a.location=e.rotateObject.getDocumentPoint(new go.Spot(.5,0,0,-30)))},t.prototype.rotate=function(e){go.RotatingTool.prototype.rotate.call(this,e+90)},(myDiagram=$$(go.Diagram,"myDiagramDiv",{grid:$$(go.Panel,"Grid",$$(go.Shape,"LineH",{stroke:"lightgray",strokeWidth:.5}),$$(go.Shape,"LineH",{stroke:"gray",strokeWidth:.5,interval:10}),$$(go.Shape,"LineV",{stroke:"lightgray",strokeWidth:.5}),$$(go.Shape,"LineV",{stroke:"gray",strokeWidth:.5,interval:10})),allowDrop:!0,"draggingTool.dragsLink":!1,"draggingTool.isGridSnapEnabled":!0,"linkingTool.isUnconnectedLinkValid":!1,"linkingTool.portGravity":20,"relinkingTool.isUnconnectedLinkValid":!0,"relinkingTool.portGravity":20,"relinkingTool.fromHandleArchetype":$$(go.Shape,"Diamond",{segmentIndex:0,cursor:"pointer",desiredSize:new go.Size(8,8),fill:"tomato",stroke:"darkred"}),"relinkingTool.toHandleArchetype":$$(go.Shape,"Diamond",{segmentIndex:-1,cursor:"pointer",desiredSize:new go.Size(8,8),fill:"darkred",stroke:"tomato"}),"linkReshapingTool.handleArchetype":$$(go.Shape,"Diamond",{desiredSize:new go.Size(7,7),fill:"lightblue",stroke:"deepskyblue"}),rotatingTool:$$(t),"rotatingTool.snapAngleMultiple":15,"rotatingTool.snapAngleEpsilon":15,"undoManager.isEnabled":!1,"toolManager.hoverDelay":0,"toolManager.holdDelay":70,"resizingTool.computeReshape":function(){return!1}})).addDiagramListener("Modified",function(e){var a=document.getElementById("SaveButton");a&&(a.disabled=!myDiagram.isModified);var t=document.title.indexOf("*");myDiagram.isModified?t<0&&(document.title+="*"):t>=0&&(document.title=document.title.substr(0,t))}),myDiagram.addDiagramListener("SelectionDeleted",function(e){e.subject.each(function(e){var a=e.part.data;delete onScreenBlocks[a.key]}),Canvas.renderActiveScreen()}),myDiagram.addDiagramListener("ExternalObjectsDropped",function(e){}),myDiagram.mouseDrop=function(e){myDiagram.nodes.each(function(e){var a=e.part.data;a&&(onScreenBlocks[a.key]=a),e.isSelected&&Canvas.showNodeProperty(null,e)}),Canvas.renderActiveScreen()},myDiagram.mouseHold=function(e){e.alt?(myDiagram.toolManager.dragSelectingTool.delay=50,myDiagram.toolManager.dragSelectingTool.doActivate()):myDiagram.toolManager.dragSelectingTool.delay=1e3},myDiagram.nodeTemplate=$$(go.Node,"Spot",{locationSpot:go.Spot.Center,background:"transparent"},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),{selectionAdornmentTemplate:n,selectionAdorned:!1},{resizable:!0,resizeObjectName:"PANEL",resizeAdornmentTemplate:o},{rotatable:!0,rotateAdornmentTemplate:l},new go.Binding("angle").makeTwoWay(),$$(go.Panel,"Auto",{name:"PANEL"},new go.Binding("desiredSize","size",go.Size.parse).makeTwoWay(go.Size.stringify),$$(go.Shape,"Rectangle",{strokeWidth:0,fromLinkable:!1,toLinkable:!1,fill:"#000000"},new go.Binding("geometryString","icon",function(e){return go.Geometry.fillPath("F "+Canvas.loadIcon(e))}))),$$(go.TextBlock,{alignment:go.Spot.BottomCenter,alignmentFocus:go.Spot.TopCenter,editable:!1},new go.Binding("text","name")),e("T",go.Spot.Top,!0,!0),e("L",go.Spot.Left,!0,!0),e("R",go.Spot.Right,!0,!0),e("B",go.Spot.Bottom,!0,!0),{mouseEnter:function(e,t){a(t,!0)},mouseLeave:function(e,t){a(t,!1)},click:Canvas.showNodeProperty,selectionChanged:function(e){Canvas.setPropertyBox(e)}}),myDiagram.paletteTemplate=$$(go.Part,"Vertical",{selectable:!0,selectionAdornmentTemplate:n},new go.Binding("angle").makeTwoWay(),$$(go.Panel,"Auto",{name:"PANEL"},new go.Binding("desiredSize","size",go.Size.parse).makeTwoWay(go.Size.stringify),$$(go.Shape,"Rectangle",{strokeWidth:0,fromLinkable:!1,toLinkable:!1,fill:"#000000",name:"SVG"},new go.Binding("geometryString","icon",function(e){return go.Geometry.fillPath("F "+Canvas.loadIcon(e))}))),$$(go.TextBlock,{editable:!1,name:"TEXTBLOCK",margin:10},new go.Binding("text","name")),{mouseEnter:function(e,a){var t=a.findObject("SVG"),n=a.findObject("TEXTBLOCK");t.fill="#6d6e71",n.font="13px sans-serif",n.stroke="#6d6e71"},mouseLeave:function(e,a){var t=a.findObject("SVG"),n=a.findObject("TEXTBLOCK");t.fill="#000000",n.font="13px sans-serif",n.stroke="black"},background:"transparent",toolTip:$$(go.Adornment,"Auto",$$(go.Shape,{fill:"#EFEFCC"}),$$(go.TextBlock,{margin:4,width:100},new go.Binding("text","description")))}),myDiagram.linkTemplate=$$(go.Link,{selectable:!0,selectionAdornmentTemplate:r},{relinkableFrom:!0,relinkableTo:!0,reshapable:!0},{routing:go.Link.AvoidsNodes,curve:go.Link.JumpOver,corner:5,toShortLength:4},new go.Binding("points").makeTwoWay(),$$(go.Shape,{isPanelMain:!0,strokeWidth:2}),$$(go.Shape,{toArrow:"Standard",stroke:null}),$$(go.Panel,"Auto",$$(go.Shape,"RoundedRectangle",{fill:"#F8F8F8",strokeWidth:1}),$$(go.TextBlock,"AND",{textAlign:"center",font:"16pt helvetica, arial, sans-serif",stroke:"#919191",margin:2,minSize:new go.Size(10,NaN),editable:!0,textEditor:window.TextEditorSelectBox,choices:["AND","OR","RETURNS"]},new go.Binding("text").makeTwoWay()))),Canvas.load()},buildPalette:function(){$(".palette").each(function(){var e=$(this).attr("id"),a=$(this).data("category-id"),t=$(this).data("tab-id"),n=[];$(t).find(".building-blocks").each(function(e,a){var t=$(a);n.push({name:t.data("name"),description:t.data("description"),values:{fields:{},results:{}},color:t.data("color"),icon:t.data("id"),iconURL:t.data("icon"),size:"60 60",isMolecule:t.data("is-molecule"),model:t.html(),tags:t.data("tags"),status:t.data("status"),dataSource:t.data("data-source"),privacy:t.data("privacy")})}),availableBlocks[a]=n;var o=$$(go.Palette,e,{layout:$$(go.GridLayout,{alignment:go.GridLayout.Location,wrappingColumn:4,spacing:new go.Size(13,13)}),allowZoom:!1,maxSelectionCount:1,nodeTemplate:myDiagram.paletteTemplate,linkTemplate:$$(go.Link,{locationSpot:go.Spot.Center,selectionAdornmentTemplate:$$(go.Adornment,"Link",{locationSpot:go.Spot.Center},$$(go.Shape,{isPanelMain:!0,fill:null,stroke:"deepskyblue",strokeWidth:0}),$$(go.Shape,{toArrow:"Standard",stroke:null}))},{routing:go.Link.AvoidsNodes,curve:go.Link.JumpOver,corner:5,toShortLength:4},new go.Binding("points"),$$(go.Shape,{isPanelMain:!0,strokeWidth:2}),$$(go.Shape,{toArrow:"Standard",stroke:null})),model:new go.GraphLinksModel(n,[]),InitialLayoutCompleted:function(e){var a=e.diagram;a.div.style.height=a.documentBounds.height+24+"px"}});diagramPalette[a]=o}),$(".tab-nav li:first-child a").click()},save:function(){Canvas.saveDiagramProperties(),document.getElementById("mySavedModel").value=myDiagram.model.toJson(),myDiagram.isModified=!1},load:function(){myDiagram.model=go.Model.fromJson($.parseJSON($("#mySavedModel").val())),Canvas.loadDiagramProperties()},saveDiagramProperties:function(){myDiagram.model.modelData.position=go.Point.stringify(myDiagram.position)},loadDiagramProperties:function(e){var a=myDiagram.model.modelData.position;a&&(myDiagram.initialPosition=go.Point.parse(a))},loadIcon:function(e){return blockIcons[e]},renderPaletteItem:function(){var e=$("#form-palette input").val();$.each(diagramPalette,function(a,t){var n=availableBlocks[a];""!==e&&(n=_.filter(n,function(a){return-1!==a.name.toLowerCase().indexOf(e.toLowerCase())})),t.model.nodeDataArray=n})},renderActiveScreen:function(){var e=$("#form-on-screen input").val(),a=onScreenBlocks;""!==e&&(a=_.filter(onScreenBlocks,function(a){return-1!==a.name.toLowerCase().indexOf(e.toLowerCase())})),$("#on-screen-block-list").empty(),$("#molecule-conditions-table > tbody").empty(),$.each(a,function(e,a){$("#on-screen-block-list").append('\n                    <a class="list-group-item media on-screen-block" href="#" data-key="'+a.key+'">\n                        <div class="pull-left">\n                            <img src="'+a.iconURL+'" alt="'+a.name+'">\n                        </div>\n                        <div class="media-body">\n                            <div class="lgi-heading">'+a.name+"</div>\n                        </div>\n                    </a>\n                ")});var t=_.size(onScreenBlocks),n=0,o=0;$.each(onScreenBlocks,function(e,a){$("#molecule-conditions-table > tbody").append('\n                    <tr>\n                        <td style="width: 10%;">\n                            <img src="'+a.iconURL+'" alt="'+a.name+'">\n                        </td>\n                        <td style="width: 65%">'+a.name+'</td>\n                        <td class="text-center" style="width: 25%">\n                            <span class="label label-'+(a.values.results.status?"success":"danger")+'">\n                                '+(a.values.results.status?"TRUE":"FALSE")+"\n                            </span>\n                        </td>\n                    </tr>\n                "),a.values.results.status&&n++}),t>0&&(o=n/t*100),$("#molecule-status-trait").find(".progress-bar").css("width",o+"%"),Canvas.updateCharts(a)},showNodeProperty:function(e,a){var t=a.part.data,n=elementIdentityForm,o=elementValuesForm;selectedElementData=t,t.isMolecule?Canvas.showMoleculeProperty(t):(n.find('[name="name"]').val(t.name),n.find('[name="status"]').val(t.status).trigger("chosen:updated"),n.find('[name="privacy"]').val(t.privacy).trigger("chosen:updated"),n.find('[name="dataSource"]').val(t.dataSource).change().trigger("chosen:updated"),n.find('[name="description"]').val(t.description),n.find('[name="key"]').val(t.key),n.find('[name="tags"]').tagsinput("destroy"),n.find('[name="tags"]').tagsinput(),n.find('[name="tags"]').tagsinput("removeAll"),$.each(t.tags.split(","),function(){n.find('[name="tags"]').tagsinput("add",this)}),o.find('[name="key"]').val(t.key),o.find('[name="user"]').val(t.values.user).trigger("chosen:updated"),o.find('[name="group"]').val(t.values.group).trigger("chosen:updated"),o.find('[name="dataType"]').val(t.values.dataType).change().trigger("chosen:updated"),$.each(t.values.fields,function(e,a){o.find('[name="'+e+'"]').val(a)}))},showMoleculeProperty:function(e){var a=JSON.parse(e.model),t=savedMoleculeIdentityForm;$.each(a.nodeDataArray,function(e,a){$("#drill-down-table > tbody").append('\n                    <tr>\n                        <td style="width: 10%;">\n                            <img style="width: 30px;" src="'+a.iconURL+'" alt="'+a.name+'">\n                        </td>\n                        <td style="width: 65%">'+a.name+'</td>\n                        <td class="text-center" style="width: 25%">\n                            <span class="label label-'+(a.values.results.status?"success":"danger")+'">\n                                '+(a.values.results.status?"TRUE":"FALSE")+"\n                            </span>\n                        </td>\n                    </tr>\n                ")}),t.find('[name="name"]').val(e.name),t.find('[name="status"]').val(e.status).trigger("chosen:updated"),t.find('[name="privacy"]').val(e.privacy).trigger("chosen:updated"),t.find('[name="dataSource"]').val(e.dataSource).change().trigger("chosen:updated"),t.find('[name="description"]').val(e.description),t.find('[name="key"]').val(e.key),t.find('[name="tags"]').tagsinput("destroy"),t.find('[name="tags"]').tagsinput(),t.find('[name="tags"]').tagsinput("removeAll"),$.each(e.tags.split(","),function(){t.find('[name="tags"]').tagsinput("add",this)})},setPropertyBox:function(e){e.isSelected?(propertyBoxTitle.text("Metric Properties"),elementProperties.removeClass("hidden"),moleculeProperties.addClass("hidden"),savedMoleculeProperties.addClass("hidden"),e.data.isMolecule&&(propertyBoxTitle.text("Metric Properties"),savedMoleculeProperties.removeClass("hidden"),elementProperties.addClass("hidden"),moleculeProperties.addClass("hidden"))):(propertyBoxTitle.text("Model Properties"),moleculeProperties.removeClass("hidden"),elementProperties.addClass("hidden"),savedMoleculeProperties.addClass("hidden")),drillDownTable.find("tbody").empty()},renderElementParams:function(e){var a="";for(var t in e)e[t].type,a+='<option value="'+e[t].name+'">'+e[t].name+"</option>";return""!==a?'<div class="form-group element-value-params">\n                <div class="fg-line">\n                    <label>Field to Query</label>\n                    <select class="form-control chosen" name="fieldToQuery">'+a+"</select>\n                </div>\n            ":a},_renderElementParams_:function(e){var a="";for(var t in e)switch(e[t].type){case"boolean":a+='\n                            <div class="form-group element-value-params">\n                                <div class="fg-line">\n                                    <label>'+e[t].name+'</label>\n                                    <select id="'+e[t].id+'" class="'+e[t].class+'" name='+e[t].name+'>\n                                        <option value="true">True</option>\n                                        <option value="false">False</option>\n                                    </select>\n                                </div>\n                            </div>\n                        ';break;default:a+='\n                            <div class="form-group element-value-params">\n                                <div class="fg-line">\n                                    <label>'+e[t].name+'</label>\n                                    <input id="'+e[t].id+'" class="'+e[t].class+'" name="'+e[t].name+'" value="'+e[t].value+'" />\n                                </div>\n                            </div>\n                        '}return a},submitForm:function(e,a){var t=e.find(".submit"),n=App.baseUrl("canvas/getElementQuery");a&&(n=App.baseUrl("user/update")),App.blockElement(e),t.attr("disabled",!0),App.ajax(n,"post","json",App.serializeForm(e)).error(function(a){App.unblockElement(e),t.attr("disabled",!1)}).done(function(a){return App.unblockElement(e),t.attr("disabled",!1),a})},add:function(){var e=App.loadModal(),a=e.find(".modal-body");e.find(".modal-title").text("Add Canvas"),App.blockElement($(a)),App.ajax(App.baseUrl("user/loadAddForm"),"get","html").error(function(a){e.find(".close").click()}).done(function(e){a.html(e),App.loadChosen(".chosen"),App.unblockElement($(a))})},edit:function(e){var a=App.loadModal(),t=a.find(".modal-body");a.find(".modal-title").text("Edit Canvas"),App.blockElement($(t)),App.ajax(App.baseUrl("user/loadEditForm"),"get","html",{id:e}).error(function(e){a.find(".close").click()}).done(function(e){t.html(e),App.loadChosen(".chosen"),App.unblockElement($(t))})},delete:function(e){swal({title:"Are you sure?",text:"You will not be able to recover the data!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(){App.ajax(App.baseUrl("user/delete"),"post","json",{id:e,parse_csrf_token:Cookies.get("parse_csrf_cookie")}).done(function(e){e.status?(Canvas.reloadGrid(),swal(e.action,e.message,"success")):swal(e.action,e.message,"error")})})},frequencyChart:function(){var e=document.getElementById("bar-chart").getContext("2d");barChart=new Chart(e,{type:"bar",data:{labels:[],datasets:[{data:[],backgroundColor:[]}]},options:{responsive:!0,title:{display:!1,text:"Chart.js Bar Chart - Multi Axis"},tooltips:{mode:"index",intersect:!0},scales:{yAxes:[{ticks:{beginAtZero:!0}}]},legend:{display:!1}}})},coVarianceChart:function(){var e=venn.VennDiagram().width(270).height(270);d3.select("#co-variance-chart").datum([{sets:["A"],size:2},{sets:["B"],size:2},{sets:["C"],size:2},{sets:["A","B"],size:.5},{sets:["A","C"],size:.5},{sets:["C","B"],size:.5}]).call(e)},populationChart:function(){var e=document.getElementById("population-chart").getContext("2d");new Chart(e,{type:"doughnut",data:{labels:["Red","Blue","Yellow","Green","Purple","Orange"],datasets:[{label:"# of Votes",data:[12,19,3,5,2,3],backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"],borderColor:["rgba(255,99,132,1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},options:{legend:{display:!1}}})},scatterChart:function(){var e=Chart.helpers.color,a={labels:[],datasets:[{label:"My First dataset",borderColor:window.chartColors.red,backgroundColor:e(window.chartColors.red).alpha(.2).rgbString(),data:[]}]};window.onload=function(){var e=document.getElementById("scatter-chart").getContext("2d");_scatterChart=Chart.Scatter(e,{data:a,options:{title:{display:!1,text:"Chart.js Scatter Chart"},legend:{display:!1},scales:{xAxes:[{type:"linear",position:"bottom",ticks:{min:0}}]},events:["click"],onClick:function(e,a){if(a.length){var t=a[0]._datasetIndex,n=a[0]._index,o=_scatterChart.data.datasets[t].data[n];if(o.hasOwnProperty("key")){var l={};l[o.key]=onScreenBlocks[o.key],Canvas.updateCharts(l)}}else Canvas.updateCharts(onScreenBlocks)}}})}},updateCharts:function(e){barChart.data.labels=[],barChart.data.datasets[0].data=[],_scatterChart.data.labels=[],_scatterChart.data.datasets[0].data=[];var a=1;$.each(e,function(e,t){var n=t.values.fields,o=t.values.results;if(n.hasOwnProperty("fieldToQuery")){var l=t.name,r=n.fieldToQuery;barChart.data.datasets.forEach(function(e){$.each(o,function(a,t){usersColor.hasOwnProperty(a)||(usersColor[a]=App.randomColor()),e.data.push(t[r]),e.backgroundColor.push(usersColor[a]),barChart.data.labels.push(l)})}),_scatterChart.data.datasets.forEach(function(t){$.each(o,function(n,o){t.data.push({x:a,y:o[r],key:e})})}),a++}}),barChart.update(),_scatterChart.update()}};
"use strict";var userGrid=$("#user-grid"),addUser=$("#add-user"),User={init:function(){User.main(),User.loadGrid()},main:function(){addUser.click(function(){User.add()}),$(document).on("submit","#add-form",function(){return User.submitForm($("#add-form"),null),!1}),$(document).on("submit","#edit-form",function(e){var t=$(this).find(".submit").val();return User.submitForm($("#edit-form"),t),!1})},submitForm:function(e,t){var n=e.find(".submit"),i=App.baseUrl("user/insert");t&&(i=App.baseUrl("user/update")),App.blockElement(e.parent()),n.attr("disabled",!0),App.ajax(i,"post","json",App.serializeForm(e)).error(function(t){App.unblockElement(e.parent()),n.attr("disabled",!1)}).done(function(t){t.status?(e.find('[data-dismiss="modal"]').click(),swal(t.action,t.message,"success"),User.reloadGrid()):(n.attr("disabled",!1),App.unblockElement(e.parent()),swal({title:t.action,text:t.message,type:"error",html:!0}))})},reloadGrid:function(){userGrid.bootgrid("reload")},loadGrid:function(){App.bootGrid(userGrid,{username:function(e,t){return'<a href="'+App.baseUrl("profile/"+t.username)+'">'+t.username+"</a>"},action:function(e,t){return'<div class="btn-group">'+('<a href="'+App.baseUrl("profile/")+t.id+'" class="btn btn-primary waves-effect action-profile" data-row-id="'+t.id+'"><span class="zmdi zmdi-face"></span></a>')+('<button type="button" class="btn bgm-amber waves-effect action-edit" data-row-id="'+t.id+'"><span class="zmdi zmdi-edit"></span></button>')+('<button type="button" class="btn btn-danger waves-effect action-delete" data-row-id="'+t.id+'"><span class="zmdi zmdi-delete"></span></button>')+"</div>"},profilePicture:function(e,t){return t.profilePicture?'<img class="lgi-img" src="'+t.profilePicture+'" alt="">':'<img class="lgi-img" src="'+App.baseUrl("uploads/avatars/noavatar.png")+'" alt="">'}}).on("loaded.rs.jquery.bootgrid",function(){App.enableColumnResize("#user-grid th"),userGrid.find(".action-edit").on("click",function(e){User.edit($(this).data("row-id"))}),userGrid.find(".action-delete").on("click",function(e){User.delete($(this).data("row-id"))})})},add:function(){var e=App.loadModal(),t=e.find(".modal-body");e.find(".modal-title").text("Add User"),App.blockElement($(t)),App.ajax(App.baseUrl("user/loadAddForm"),"get","html").error(function(t){e.find(".close").click()}).done(function(e){t.html(e),App.loadChosen(".chosen"),App.unblockElement($(t))})},edit:function(e){var t=App.loadModal(),n=t.find(".modal-body");t.find(".modal-title").text("Edit User"),App.blockElement($(n)),App.ajax(App.baseUrl("user/loadEditForm"),"get","html",{id:e}).error(function(e){t.find(".close").click()}).done(function(e){n.html(e),App.loadChosen(".chosen"),App.unblockElement($(n))})},delete:function(e){swal({title:"Are you sure?",text:"You will not be able to recover the data!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(){App.ajax(App.baseUrl("user/delete"),"post","json",{id:e,parse_csrf_token:Cookies.get("parse_csrf_cookie")}).done(function(e){e.status?(User.reloadGrid(),swal(e.action,e.message,"success")):swal(e.action,e.message,"error")})})}};